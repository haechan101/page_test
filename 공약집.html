
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>대선 이슈 시각화</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { max-width: 1200px; margin: 24px auto; font-family: system-ui, -apple-system, "Malgun Gothic", sans-serif; }
    h2, h3 { margin: 0 0 12px; }
    #line-chart, #bar-chart { width: 100%; }
  </style>
</head>
<body>
  <h2>대선별 주요 이슈 주목도 변화</h2>
  <div id="line-chart"></div>

  <h3 style="margin-top:28px;">클릭한 이슈의 키워드 기여도</h3>
  <div id="bar-chart"></div>

  <script>
    const df = [{"index":"17대_이명박","청년":22.83,"고용":20.39,"복지":19.35,"지역":14.54,"안보":9.96,"기술":7.28,"젠더":5.65},{"index":"18대_박근혜","청년":19.9,"고용":17.01,"복지":17.05,"지역":15.8,"안보":7.23,"기술":6.16,"젠더":16.86},{"index":"19대_문재인","청년":18.37,"고용":21.7,"복지":15.0,"지역":14.69,"안보":9.97,"기술":4.13,"젠더":16.13},{"index":"20대_윤석열","청년":18.48,"고용":14.36,"복지":12.55,"지역":18.49,"안보":15.38,"기술":13.38,"젠더":7.36},{"index":"21대_이재명","청년":17.45,"고용":19.64,"복지":16.67,"지역":14.11,"안보":17.86,"기술":10.08,"젠더":4.2}];
    const categoryCounts = {"17대_이명박": {"청년": 249, "고용": 199, "복지": 171, "지역": 123, "안보": 99, "기술": 102, "젠더": 64}, "18대_박근혜": {"청년": 334, "고용": 457, "복지": 322, "지역": 216, "안보": 114, "기술": 164, "젠더": 200}, "19대_문재인": {"청년": 304, "고용": 533, "복지": 316, "지역": 191, "안보": 103, "기술": 186, "젠더": 192}, "20대_윤석열": {"청년": 368, "고용": 347, "복지": 324, "지역": 225, "안보": 221, "기술": 614, "젠더": 143}, "21대_이재명": {"청년": 352, "고용": 415, "복지": 276, "지역": 275, "안보": 111, "기술": 712, "젠더": 111}};
    const keywordData = {"17대_이명박": {"청년": [{"keyword": "대학", "count": 115}, {"keyword": "취업", "count": 22}, {"keyword": "공정", "count": 21}, {"keyword": "희망", "count": 18}, {"keyword": "신혼부부", "count": 17}], "고용": [{"keyword": "일자리", "count": 58}, {"keyword": "규제", "count": 32}, {"keyword": "산업", "count": 26}, {"keyword": "취업", "count": 22}, {"keyword": "경제성장", "count": 12}], "복지": [{"keyword": "복지", "count": 41}, {"keyword": "보건", "count": 20}, {"keyword": "의료", "count": 17}, {"keyword": "저소득층", "count": 13}, {"keyword": "노인", "count": 12}], "지역": [{"keyword": "주택", "count": 24}, {"keyword": "공급", "count": 18}, {"keyword": "수도권", "count": 17}, {"keyword": "농어촌", "count": 15}, {"keyword": "발전", "count": 11}], "안보": [{"keyword": "외교", "count": 20}, {"keyword": "북한", "count": 18}, {"keyword": "중국", "count": 13}, {"keyword": "협력", "count": 13}, {"keyword": "미국", "count": 7}], "기술": [{"keyword": "에너지", "count": 34}, {"keyword": "기술", "count": 14}, {"keyword": "인프라", "count": 13}, {"keyword": "혁신", "count": 11}, {"keyword": "R&D", "count": 7}], "젠더": [{"keyword": "차별", "count": 12}, {"keyword": "출산", "count": 12}, {"keyword": "여성", "count": 7}, {"keyword": "갈등", "count": 6}, {"keyword": "인권", "count": 4}]}, "18대_박근혜": {"청년": [{"keyword": "대학", "count": 130}, {"keyword": "미래", "count": 57}, {"keyword": "고립", "count": 23}, {"keyword": "청년", "count": 22}, {"keyword": "창업", "count": 17}], "고용": [{"keyword": "일자리", "count": 138}, {"keyword": "근로자", "count": 62}, {"keyword": "비정규직", "count": 45}, {"keyword": "소상공인", "count": 39}, {"keyword": "고용", "count": 24}], "복지": [{"keyword": "장애인", "count": 67}, {"keyword": "소득", "count": 51}, {"keyword": "복지", "count": 50}, {"keyword": "건강보험", "count": 21}, {"keyword": "노인", "count": 17}], "지역": [{"keyword": "농어촌", "count": 58}, {"keyword": "발전", "count": 25}, {"keyword": "지방", "count": 21}, {"keyword": "공공기관", "count": 20}, {"keyword": "수도권", "count": 17}], "안보": [{"keyword": "협력", "count": 21}, {"keyword": "외교", "count": 19}, {"keyword": "국방", "count": 14}, {"keyword": "북한", "count": 12}, {"keyword": "평화", "count": 9}], "기술": [{"keyword": "에너지", "count": 42}, {"keyword": "R&D", "count": 38}, {"keyword": "인프라", "count": 22}, {"keyword": "기술", "count": 9}, {"keyword": "혁신", "count": 9}], "젠더": [{"keyword": "여성", "count": 56}, {"keyword": "출산", "count": 25}, {"keyword": "임신", "count": 23}, {"keyword": "아이", "count": 18}, {"keyword": "성범죄", "count": 15}]}, "19대_문재인": {"청년": [{"keyword": "대학", "count": 127}, {"keyword": "청년", "count": 55}, {"keyword": "창업", "count": 24}, {"keyword": "희망", "count": 22}, {"keyword": "신혼부부", "count": 12}], "고용": [{"keyword": "일자리", "count": 180}, {"keyword": "비정규직", "count": 52}, {"keyword": "산업", "count": 33}, {"keyword": "근로자", "count": 30}, {"keyword": "소상공인", "count": 30}], "복지": [{"keyword": "복지", "count": 61}, {"keyword": "장애인", "count": 32}, {"keyword": "건강보험", "count": 22}, {"keyword": "주거", "count": 21}, {"keyword": "소득", "count": 19}], "지역": [{"keyword": "발전", "count": 23}, {"keyword": "공급", "count": 22}, {"keyword": "지자체", "count": 17}, {"keyword": "공공기관", "count": 16}, {"keyword": "균형", "count": 13}], "안보": [{"keyword": "협력", "count": 25}, {"keyword": "북한", "count": 9}, {"keyword": "남북관계", "count": 8}, {"keyword": "중국", "count": 8}, {"keyword": "외교", "count": 7}], "기술": [{"keyword": "R&D", "count": 31}, {"keyword": "혁신", "count": 28}, {"keyword": "에너지", "count": 25}, {"keyword": "기술", "count": 16}, {"keyword": "인프라", "count": 15}], "젠더": [{"keyword": "여성", "count": 27}, {"keyword": "출산", "count": 24}, {"keyword": "인권", "count": 24}, {"keyword": "저출산", "count": 18}, {"keyword": "차별", "count": 16}]}, "20대_윤석열": {"청년": [{"keyword": "대학", "count": 99}, {"keyword": "부채", "count": 56}, {"keyword": "청년", "count": 44}, {"keyword": "미래", "count": 35}, {"keyword": "희망", "count": 25}], "고용": [{"keyword": "일자리", "count": 65}, {"keyword": "산업", "count": 42}, {"keyword": "중소", "count": 31}, {"keyword": "규제", "count": 28}, {"keyword": "근로자", "count": 26}], "복지": [{"keyword": "장애인", "count": 80}, {"keyword": "돌봄", "count": 34}, {"keyword": "주거", "count": 25}, {"keyword": "복지", "count": 24}, {"keyword": "의료", "count": 17}], "지역": [{"keyword": "발전", "count": 37}, {"keyword": "주택", "count": 31}, {"keyword": "공급", "count": 25}, {"keyword": "수도권", "count": 24}, {"keyword": "지자체", "count": 16}], "안보": [{"keyword": "협력", "count": 42}, {"keyword": "외교", "count": 30}, {"keyword": "미국", "count": 16}, {"keyword": "비핵화", "count": 14}, {"keyword": "안보", "count": 13}], "기술": [{"keyword": "디지털", "count": 143}, {"keyword": "AI", "count": 56}, {"keyword": "플랫폼", "count": 49}, {"keyword": "기술", "count": 47}, {"keyword": "혁신", "count": 43}], "젠더": [{"keyword": "돌봄", "count": 34}, {"keyword": "여성", "count": 14}, {"keyword": "갈등", "count": 11}, {"keyword": "아이", "count": 10}, {"keyword": "성범죄", "count": 8}]}, "21대_이재명": {"청년": [{"keyword": "대학", "count": 89}, {"keyword": "청년", "count": 68}, {"keyword": "희망", "count": 37}, {"keyword": "미래", "count": 24}, {"keyword": "차세대", "count": 17}], "고용": [{"keyword": "소상공인", "count": 72}, {"keyword": "산업", "count": 67}, {"keyword": "스타트업", "count": 38}, {"keyword": "규제", "count": 34}, {"keyword": "근로자", "count": 26}], "복지": [{"keyword": "장애인", "count": 35}, {"keyword": "돌봄", "count": 32}, {"keyword": "노인", "count": 21}, {"keyword": "고령화", "count": 20}, {"keyword": "취약계층", "count": 19}], "지역": [{"keyword": "공공기관", "count": 47}, {"keyword": "지자체", "count": 41}, {"keyword": "공급", "count": 37}, {"keyword": "발전", "count": 27}, {"keyword": "주택", "count": 22}], "안보": [{"keyword": "협력", "count": 36}, {"keyword": "평화", "count": 22}, {"keyword": "방산", "count": 7}, {"keyword": "국방", "count": 7}, {"keyword": "안보", "count": 6}], "기술": [{"keyword": "AI", "count": 189}, {"keyword": "R&D", "count": 59}, {"keyword": "디지털", "count": 51}, {"keyword": "혁신", "count": 50}, {"keyword": "인프라", "count": 46}], "젠더": [{"keyword": "돌봄", "count": 32}, {"keyword": "여성", "count": 14}, {"keyword": "인권", "count": 8}, {"keyword": "육아휴직", "count": 8}, {"keyword": "갈등", "count": 7}]}};

    const colorMap = {
      "복지": "#1f77b4", "고용": "#ff7f0e", "청년": "#2ca02c",
      "지역": "#9467bd", "젠더": "#e377c2", "안보": "#d62728", "기술": "#8c564b"
    };

    const categories = Object.keys(df[0]).filter(k => k !== "index");

    const traces = categories.map(category => {
      const xs = df.map(row => row.index);
      const ys = df.map(row => row[category]);
      const cds = df.map(row => {
        const cand = row.index;
        const count = (categoryCounts[cand] && categoryCounts[cand][category]) || 0;
        return [cand, category, count];
      });
      const col = colorMap[category] || "#888";
      return {
        x: xs, y: ys, mode: "lines+markers", name: category,
        line: { color: col }, marker: { color: col },
        customdata: cds,
        hovertemplate:
          "%{customdata[0]} · %{customdata[1]}<br>" +
          "주목도: %{y:.2f}%<br>" +
          "언급: %{customdata[2]}회<extra></extra>"
      };
    });

    Plotly.newPlot("line-chart", traces, {
      title: "대선별 주요 이슈 주목도 변화",
      xaxis: { title: "대선 회차" },
      yaxis: { title: "주목도 비율 (%)" },
      hovermode: "closest",
      legend: { orientation: "v", x: 1.02, xanchor: "left", y: 1 },
      margin: { t: 60, r: 150, l: 60, b: 60 }
    });

    function renderBar(cand, category) {
      const items = (keywordData[cand] && keywordData[cand][category]) || [];
      if (!items.length) {
        Plotly.newPlot("bar-chart", [], { title: `[${cand}] '${category}' 데이터 없음` });
        return;
      }
      const top = items.slice().sort((a,b) => b.count - a.count).slice(0, 10);
      const keywords = top.map(d => d.keyword);
      const counts = top.map(d => d.count);
      const total = counts.reduce((a,b) => a + b, 0) || 1;
      const ratios = counts.map(c => c / total);
      const col = colorMap[category] || "#888";

      Plotly.newPlot("bar-chart", [{
        x: keywords, y: ratios, type: "bar",
        marker: { color: col },
        customdata: counts,
        hovertemplate: "<b>%{x}</b><br>언급: %{customdata}회<br>비율: %{y:.1%}<extra></extra>"
      }], {
        title: `[${cand}] '${category}' 키워드 기여도`,
        xaxis: { title: "키워드" },
        yaxis: { title: "비율 (Normalized)", tickformat: ".0%" },
        margin: { t: 60, r: 60, l: 60, b: 80 }
      });
    }

    if (df.length > 0 && categories.length > 0) {
      renderBar(df[0].index, categories[0]);
    }
    document.getElementById("line-chart").on("plotly_click", function (ev) {
      const [cand, category] = ev.points[0].customdata;
      renderBar(cand, category);
    });
  </script>
</body>
</html>
